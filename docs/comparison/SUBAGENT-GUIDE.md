# å­Agentæºç å¯¹é½å·¥ä½œæŒ‡å—

## ğŸš¨ é‡è¦æé†’ - å¿…é¡»å…ˆçœ‹å®˜æ–¹æºç ï¼

**åœ¨è¿›è¡Œä»»ä½•ä»£ç è¡¥é½å·¥ä½œä¹‹å‰ï¼Œå¿…é¡»ï¼š**
1. å…ˆé˜…è¯»å¯¹åº”å¯¹æ¯”æ–‡æ¡£ä¸­çš„å®˜æ–¹æºç å¼•ç”¨ä½ç½®
2. ä½¿ç”¨ Read å·¥å…·æŸ¥çœ‹å®˜æ–¹æºç çš„å®é™…å®ç°
3. ç†è§£å®˜æ–¹çš„è®¾è®¡æ€è·¯å’Œä»£ç é€»è¾‘
4. ç„¶åå†è¿›è¡Œæœ¬é¡¹ç›®çš„ä»£ç å®ç°

---

## ğŸ“ å®˜æ–¹æºç ä½ç½®

```
/home/user/claude-code-open/node_modules/@anthropic-ai/claude-code/
â”œâ”€â”€ cli.js              # ä¸»ç¨‹åº (5039è¡Œ, æ··æ·†å‹ç¼©, ~11MB)
â”œâ”€â”€ sdk-tools.d.ts      # ç±»å‹å®šä¹‰ (64KB)
â”œâ”€â”€ resvg.wasm          # SVGæ¸²æŸ“ WASM
â”œâ”€â”€ tree-sitter.wasm    # ä»£ç è§£æ WASM
â”œâ”€â”€ tree-sitter-bash.wasm
â””â”€â”€ vendor/             # ä¾›åº”å•†ä¾èµ–
```

### å¦‚ä½•é˜…è¯»å®˜æ–¹æºç 

ç”±äº `cli.js` æ˜¯å‹ç¼©æ··æ·†çš„ï¼Œä½¿ç”¨ä»¥ä¸‹æŠ€å·§ï¼š

```bash
# 1. æœç´¢ç‰¹å®šå…³é”®è¯çš„ä½ç½®
grep -n "WebSocketTransport" node_modules/@anthropic-ai/claude-code/cli.js

# 2. è¯»å–ç‰¹å®šè¡Œå·é™„è¿‘çš„ä»£ç 
sed -n '4870,4900p' node_modules/@anthropic-ai/claude-code/cli.js

# 3. ä½¿ç”¨ Read å·¥å…·è¯»å–ç‰¹å®šè¡Œ
Read: /home/user/claude-code-open/node_modules/@anthropic-ai/claude-code/cli.js
      offset: 4870, limit: 50
```

### å¯¹æ¯”æ–‡æ¡£ä¸­çš„æºç å¼•ç”¨æ ¼å¼

æ¯ä»½å¯¹æ¯”æ–‡æ¡£éƒ½åŒ…å«å®˜æ–¹æºç ä½ç½®å¼•ç”¨ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
- `cli.js:4870` - è¡¨ç¤º cli.js ç¬¬ 4870 è¡Œ
- `cli.js:4870-4873` - è¡¨ç¤ºç¬¬ 4870 åˆ° 4873 è¡Œ

**ç¤ºä¾‹ï¼š**
```markdown
### å®˜æ–¹å‚è€ƒ
ä»æœç´¢ç»“æœå¯è§å®˜æ–¹ä½¿ç”¨äº† Anthropic SDKï¼š
```javascript
// cli.js:856
new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
```
```

---

## ğŸ“Š ä»»åŠ¡ä¼˜å…ˆçº§åˆ†ç±»

### P0 - ä¸¥é‡ç¼ºå¤± (ä¼˜å…ˆå¤„ç†)

| ç¼–å· | æ¨¡å— | å¯¹æ¯”æ–‡æ¡£ | å®˜æ–¹æºç ä½ç½® | å®Œæˆåº¦ |
|------|------|----------|--------------|--------|
| T484-T491 | WebSocket MCP | 42-websocket.md | cli.js:4870-4873 | 0% |
| T502-T511 | Actionç”Ÿå‘½å‘¨æœŸ | 44-lifecycle.md | cli.js:4972-4994, 5038 | 0% |
| T407-T416 | ç³»ç»Ÿæç¤ºè¯ | 35-prompt.md | å¾…å®š | 22% |
| T291-T298 | Git é›†æˆ | 26-git.md | å¾…å®š | 19% |
| T098-T104 | Web å·¥å…· | 09-web-tools.md | å¾…å®š | 20% |

### P1 - éœ€è¦æ”¹è¿›

| ç¼–å· | æ¨¡å— | å¯¹æ¯”æ–‡æ¡£ | å®Œæˆåº¦ |
|------|------|----------|--------|
| T250-T257 | ä»£ç è§£æ | 21-parser.md | 23% |
| T343-T357 | IDE é›†æˆ | 30-ide.md | 30% |
| T333-T342 | æµå¼å¤„ç† | 29-streaming.md | 35% |
| T358-T367 | åª’ä½“å¤„ç† | 31-media.md | 37% |
| T321-T332 | ä¸Šä¸‹æ–‡ç®¡ç† | 28-context.md | 38% |
| T395-T406 | å®‰å…¨éªŒè¯ | 34-security.md | 43% |
| T131-T142 | æ²™ç®±ç³»ç»Ÿ | 12-sandbox.md | 46% |
| T368-T379 | ç½‘ç»œä¸ä»£ç† | 32-network.md | 50% |
| T453-T467 | ç¯å¢ƒå˜é‡ | 40-env.md | 53% |
| T031-T040 | å¤šæ¨¡å‹æ”¯æŒ | 03-multi-model.md | 54% |

### P2 - å¾…ä¼˜åŒ–

| ç¼–å· | æ¨¡å— | å¯¹æ¯”æ–‡æ¡£ | å®Œæˆåº¦ |
|------|------|----------|--------|
| T021-T030 | API å®¢æˆ·ç«¯ | 02-api-client.md | 60% |
| T143-T157 | ä¼šè¯ç®¡ç† | 13-session.md | 67% |
| T176-T190 | MCP é›†æˆ | 15-mcp.md | 67% |
| T158-T175 | é…ç½®ç³»ç»Ÿ | 14-config.md | 70% |
| T203-T212 | æ’ä»¶ç³»ç»Ÿ | 17-plugins.md | 80% |
| T380-T394 | å­ä»£ç†ç³»ç»Ÿ | 33-subagent.md | 81% |

---

## ğŸ“‹ å­Agentå·¥ä½œæµç¨‹

### ç¬¬ä¸€æ­¥ï¼šé˜…è¯»å¯¹æ¯”æ–‡æ¡£

```bash
# è¯»å–æŒ‡å®šæ¨¡å—çš„å¯¹æ¯”æ–‡æ¡£
Read: /home/user/claude-code-open/docs/comparison/42-websocket.md
```

### ç¬¬äºŒæ­¥ï¼šæŸ¥é˜…å®˜æ–¹æºç 

æ ¹æ®å¯¹æ¯”æ–‡æ¡£ä¸­çš„è¡Œå·å¼•ç”¨ï¼Œè¯»å–å®˜æ–¹å®ç°ï¼š

```bash
# ç¤ºä¾‹ï¼šé˜…è¯» WebSocket ä¼ è¾“ç›¸å…³ä»£ç 
Read: /home/user/claude-code-open/node_modules/@anthropic-ai/claude-code/cli.js
      offset: 4870, limit: 100
```

### ç¬¬ä¸‰æ­¥ï¼šç†è§£æœ¬é¡¹ç›®ç°æœ‰å®ç°

```bash
# è¯»å–æœ¬é¡¹ç›®å¯¹åº”æ¨¡å—
Read: /home/user/claude-code-open/src/mcp/connection.ts
```

### ç¬¬å››æ­¥ï¼šå®ç°ä»£ç 

å‚è€ƒå®˜æ–¹è®¾è®¡æ€è·¯ï¼Œç¼–å†™ç¬¦åˆæœ¬é¡¹ç›®æ¶æ„çš„å®ç°ä»£ç ã€‚

### ç¬¬äº”æ­¥ï¼šéªŒè¯æµ‹è¯•

```bash
# ç±»å‹æ£€æŸ¥
npx tsc --noEmit

# è¿è¡Œæµ‹è¯•
npm run test
```

---

## ğŸ” å¸¸ç”¨æœç´¢å‘½ä»¤

### åœ¨å®˜æ–¹æºç ä¸­æœç´¢

```bash
# æœç´¢å‡½æ•°åæˆ–å˜é‡å
grep -n "functionName" node_modules/@anthropic-ai/claude-code/cli.js

# æœç´¢ç±»å
grep -n "class.*WebSocket" node_modules/@anthropic-ai/claude-code/cli.js

# æœç´¢é”™è¯¯ç±»å‹
grep -n "overloaded_error" node_modules/@anthropic-ai/claude-code/cli.js
```

### åœ¨æœ¬é¡¹ç›®ä¸­æœç´¢

```bash
# ä½¿ç”¨ Grep å·¥å…·
Grep: pattern="WebSocket", path="/home/user/claude-code-open/src"
```

---

## ğŸ“‚ æœ¬é¡¹ç›®å…³é”®ç›®å½•

```
/home/user/claude-code-open/src/
â”œâ”€â”€ cli.ts              # CLI å…¥å£
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ client.ts       # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ session.ts      # ä¼šè¯ç®¡ç†
â”‚   â””â”€â”€ loop.ts         # ä¼šè¯å¾ªç¯
â”œâ”€â”€ tools/              # å·¥å…·å®ç°
â”œâ”€â”€ mcp/                # MCP é›†æˆ
â”œâ”€â”€ hooks/              # Hooks ç³»ç»Ÿ
â”œâ”€â”€ config/             # é…ç½®ç³»ç»Ÿ
â”œâ”€â”€ ui/                 # UI ç»„ä»¶
â”œâ”€â”€ parser/             # ä»£ç è§£æ
â”œâ”€â”€ streaming/          # æµå¼å¤„ç†
â””â”€â”€ search/             # æœç´¢å·¥å…· (ripgrep)
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¿…é¡»éµå¾ªçš„åŸåˆ™

1. **å…ˆè¯»åå†™** - å¿…é¡»å…ˆé˜…è¯»å®˜æ–¹æºç ï¼Œç†è§£è®¾è®¡æ„å›¾
2. **ä¿æŒä¸€è‡´** - å°½é‡ä¸å®˜æ–¹çš„ API æ¥å£å’Œè¡Œä¸ºä¿æŒä¸€è‡´
3. **æ¸è¿›å®ç°** - å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†å®Œå–„è¾¹ç¼˜æƒ…å†µ
4. **ç±»å‹å®‰å…¨** - ç¡®ä¿ TypeScript ç±»å‹æ­£ç¡®
5. **é”™è¯¯å¤„ç†** - å‚è€ƒå®˜æ–¹çš„é”™è¯¯å¤„ç†æ–¹å¼

### å¸¸è§æ··æ·†å˜é‡åå¯¹ç…§

å®˜æ–¹ cli.js ä½¿ç”¨äº†å˜é‡æ··æ·†ï¼Œå¸¸è§æ¨¡å¼ï¼š

| æ··æ·†å | å¯èƒ½å«ä¹‰ |
|--------|----------|
| `Xv` | WebSocket ç±» |
| `k` | æ—¥å¿—å‡½æ•° |
| `V3` | é¥æµ‹å‡½æ•° |
| `x9` | ç”Ÿå‘½å‘¨æœŸäº‹ä»¶è§¦å‘ |
| `HqA` | ä»£ç†é…ç½®å‡½æ•° |
| `VNA` | å¾ªç¯ç¼“å†²åŒºç±» |

### é‡è¦å¸¸é‡

```javascript
// åœ¨ cli.js ä¸­å‘ç°çš„å¸¸é‡
var WK7 = 1000;   // æ¶ˆæ¯ç¼“å†²åŒºå¤§å°
var yD9 = 3;      // æœ€å¤§é‡è¿æ¬¡æ•°
var KK7 = 1000;   // åŸºç¡€å»¶è¿Ÿ (ms)
var VK7 = 30000;  // æœ€å¤§å»¶è¿Ÿ (ms)
var HK7 = 10000;  // Ping é—´éš” (ms)
```

---

## ğŸ“ æäº¤è§„èŒƒ

å®Œæˆä»£ç åï¼Œæäº¤ä¿¡æ¯æ ¼å¼ï¼š

```
feat(æ¨¡å—å): å®ç° Txxx-Txxx åŠŸèƒ½ç‚¹

- å¯¹é½å®˜æ–¹ cli.js:xxxx-xxxx å®ç°
- è¯¦ç»†æè¿°æ”¹åŠ¨å†…å®¹
```

ç¤ºä¾‹ï¼š
```
feat(websocket): å®ç° T484-T491 WebSocket MCP ä¼ è¾“

- å¯¹é½å®˜æ–¹ cli.js:4870-4873 å®ç°
- æ·»åŠ  WebSocketConnection ç±»
- å®ç°æ¶ˆæ¯é‡æ”¾ã€keepaliveã€é‡è¿ç­–ç•¥
- æ·»åŠ è®¤è¯å’Œé”™è¯¯å¤„ç†
```

---

## ğŸ”— ç›¸å…³èµ„æº

- **å¯¹æ¯”æ–‡æ¡£ç›®å½•**: `/home/user/claude-code-open/docs/comparison/`
- **æ€»ç»“æŠ¥å‘Š**: `/home/user/claude-code-open/docs/comparison/00-SUMMARY.md`
- **å®˜æ–¹åŒ…**: `/home/user/claude-code-open/node_modules/@anthropic-ai/claude-code/`
- **é¡¹ç›®æ¶æ„**: `/home/user/claude-code-open/CLAUDE.md`

---

**æœ€åæ›´æ–°**: 2025-12-25
**é€‚ç”¨ç‰ˆæœ¬**: @anthropic-ai/claude-code v2.0.76
